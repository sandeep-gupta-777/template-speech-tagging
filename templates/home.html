<!DOCTYPE html>
<html lang="en">
<head>
    <title>ASR</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!--<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>-->
    <script src="https://localhost:7000/static/recorder.js"></script>


    <!--sandeep imports-->
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="bootstrap4/js/bootstrap.bundle.js"></script>
    <link rel="stylesheet" href="bootstrap4/css/bootstrap.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="utility.css">
    <link rel="stylesheet" href="bootstrap-override.css">
    <link rel="stylesheet" href="file-upload-button.css">
    <link rel="stylesheet" href="base.css">

    <!--<style>-->
        <!--body {-->
            <!--background-color: white;-->

        <!--}-->

        <!--body {-->
            <!--font-family: 'Raleway', sans-serif;-->
            <!--background: url("static/logos/sptxt.jpg") no-repeat;-->
            <!--background-size: 100%;-->

        <!--}-->

        <!--* {-->
            <!--padding: 0px;-->
            <!--margin: 0px;-->
        <!--}-->

        <!--#image h1 {-->
            <!--text-decoration: none;-->
            <!--color: white;-->
        <!--}-->

        <!--#image h1 {-->
            <!--float: left;-->
            <!--margin-left: 15px;-->
            <!--margin-top: 10px;-->
            <!--font-size: 2.5em;-->
        <!--}-->

        <!--#image {-->
            <!--width: 100%;-->
            <!--height: 60px;-->
            <!--line-height: 60px;-->
            <!--background-color: #0e5d6054;-->
        <!--}-->

        <!--#main-content {-->
            <!--width: 100%;-->
            <!--height: 60px;-->

            <!--text-align: center;-->
            <!--line-height: 20px;-->
            <!--color: black;-->
        <!--}-->

        <!--label {-->
            <!--font-size: 12px;-->
        <!--}-->

        <!--#absolute {-->
            <!--width: 45%;-->
            <!--height: 260px;-->
            <!--margin-left: 25px;-->
            <!--margin-top: 30px;-->
            <!--font-size: 10px;-->
            <!--background-color: rgb(255, 255, 255, 0.02);-->
            <!--padding-right: 40px;-->
            <!--float: left;-->
        <!--}-->

        <!--#absolute h5 strong {-->
            <!--padding-right: 37px;-->
        <!--}-->

        <!--#audio {-->
            <!--top: 210px;-->
            <!--left: 65px;-->
            <!--font-size: 10px;-->

        <!--}-->

        <!--#absolute1 {-->
            <!--position: absolute;-->
            <!--top: 290px;-->
            <!--left: 60px;-->

        <!--}-->

        <!--#transcript {-->
            <!--width: 50%;-->
            <!--top: 400px;-->
            <!--left: 60px;-->
            <!--font-style: bold;-->
            <!--font-size: 1.2em;-->
            <!--padding: 3px;-->
            <!--float: right;-->
        <!--}-->


    <!--</style>-->
</head>
<body style="width:100%;">
<!--<div id="image" class="container">-->

<!--&lt;!&ndash;<img src="https://www.ramsoft.com/wp-content/uploads/2016/03/voice-recognition-ramsoft-icon1.png" height= "75" width="100"   style="float:left;"/>&ndash;&gt;-->
<!--<h1>Speech Tagging System</h1>-->
<!--<br/>-->
<!--<br/>-->
<!--&lt;!&ndash; <h4 style="font-family:Lucida Calligraphy;">Upload a .wav file with less than 10sec duration for best performance</h4> &ndash;&gt;-->
<!--</div>-->

<header class="container p-4">
    <div class="row d-flex justify-content-center">
        <h2 class="main-header-text text-center">Speech Tagging Application</h2>
    </div>
</header>

<div class="container">

    <div class="row">

        <!--control on left side started-->
        <div class="col-6">
            <div class="col-12">

                <!--<div style="margin-right:40px;">          &lt;!&ndash;changes from 111 to 120&ndash;&gt;-->
                    <!--<h7><label>Choose your language</label></h7>-->
                    <!--<select id="country-select" data-placeholder="Choose a Language..."-->
                            <!--style="padding-left:30px;padding-right:30px;padding-top:5px;padding-bottom:5px;color:black;">-->
                        <!--<option selected="selected">Choose your language</option>-->
                        <!--<option value="te-IN">TELUGU</option>-->
                        <!--<option value="en-IN">ENGLISH</option>-->
                        <!--<option value="hi-IN">HINDI</option>-->
                    <!--</select>-->
                    <!--<input id="lang" value="Select" type="button"-->
                           <!--style="padding-left:10px;padding-right:10px;color:black;   border-width: 3px 3px 3px 3px; border-color: floralwhite;"/>-->
                <!--</div>-->

                <section class="col-12 col-md-6 control-box p-5">
                    <div class="col-12 mb-30 d-flex flex-column align-items-center justify-content-center">
                        <p class="pb-1 mb-1">Choose Your Language</p>
                        <div class="dropdown" id="country-select">
                            <!-- to find the value use: $('#choose-language-button').text();-->
                            <button type="button" id="choose-language-button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                                Choose
                            </button>
                            <div class="dropdown-menu">
                                <a class="dropdown-item">Telugu</a>
                                <a class="dropdown-item">English</a>
                                <a class="dropdown-item">Hindi</a>
                            </div>
                        </div>
                    </div>
                </section>

            </div>
            <div class="col-12">
                <h5><strong>Upload your audio file below</strong></h5>
                <form method="POST" action="." enctype="multipart/form-data" class="form-inline" onSubmit="checkforblank()">
                    <div class="form-group">
                        <input name="file" id="file" type="file" class="form-control"
                               style="font-size:12px;background-color:#ececece5;padding-right:53px;padding-top:2px;width:auto;height:28px"/>
                        <input type="submit" name="Submit" value="Submit"
                               style="margin-right:40px;padding-right:20px;padding-left:20px;margin-top:20px;color:black;border-width: 3px 3px 3px 3px; border-color: floralwhite;"/>
                    </div>
                </form>
            </div>

            <div class="col-12">
                <h5><strong>Or</strong></h5>
                <div id="audio" style="display:block;">
                    <h5><strong>Record your audio here</strong></h5>
                    <input type="button" id=startRecord value="Start Rec" onclick="startRecording()"
                           style="padding-left:30px;padding-right:30px;margin-right:43px;color:green;border-width: 3px 3px 3px 3px; border-color: floralwhite;"/>
                    <input type="button" id=stopRecord value="Stop Rec" onclick="stopRecording()"
                           style="color:red;padding-left:30px;padding-right: 30px;margin-right:50px;margin-top:20px;border-width: 3px 3px 3px 3px; border-color: floralwhite;"/>
                </div>
                <p>
                    <audio id=recordedAudio style="margin-right:57px;margin-top:20px;"></audio>
                </p>
            </div>
        </div>
        <!--control on right side started-->

        <div class="col-6">
            <div id="transcript" class="container"
                 style="background-color:rgb(218, 218, 218);width:50%;border:2px inset #ddeeee;padding-left:10px;display:{{vis}} ;">
                <h4><strong>Original Text:</strong><i id="trans0" style="background-color:rgba(102, 102, 102, 0.3);">{{original_text}}</i>
                </h4>
                <h4><strong>Text: </strong><i id="trans">{{asr}}</i></h4>
                <h4><strong>Speech Tags: </strong><i id="trans1">{{tag}}</i></h4>
                    <h4><strong>Processing Time: </strong><i id="trans2">{{processing_time}}</i></h4>

                        <!-- <ul id="trans" style="display:None;list-style-type:square;max-height:118px;overflow-y:auto;">
                        {%for transcript in transcripts%}
                        <li>{{transcript}}</li>
                        {%endfor%}
                        </ul>
                        <h4><strong>Kaldi Fischer</strong></h4>
                        <ul id="trans1" style="display:None;list-style-type:square;max-height:118px;overflow-y:auto;">
                        {%for transcript1 in transcripts1%}
                        <li>{{transcript1}}</li>
                        {%endfor%}
                        </ul> -->
            </div>
        </div>

    </div>
</div>


<!--<div id="main-content" style="color:white;">-->
    <!--&lt;!&ndash;<h4>Record an audio/Upload a .wav file with less than 10sec duration for best performance</h4>&ndash;&gt;-->

    <!--<div id="absolute"  class="container border1" style="display:block;color:white;">-->


        <!--&lt;!&ndash;<div style="margin-right:40px;">          &lt;!&ndash;changes from 111 to 120&ndash;&gt;&ndash;&gt;-->
            <!--&lt;!&ndash;<h7><label>Choose your language</label></h7>&ndash;&gt;-->
            <!--&lt;!&ndash;<select id="country-select" data-placeholder="Choose a Language..."&ndash;&gt;-->
                    <!--&lt;!&ndash;style="padding-left:30px;padding-right:30px;padding-top:5px;padding-bottom:5px;color:black;">&ndash;&gt;-->
                <!--&lt;!&ndash;<option selected="selected">Choose your language</option>&ndash;&gt;-->
                <!--&lt;!&ndash;<option value="te-IN">TELUGU</option>&ndash;&gt;-->
                <!--&lt;!&ndash;<option value="en-IN">ENGLISH</option>&ndash;&gt;-->
                <!--&lt;!&ndash;<option value="hi-IN">HINDI</option>&ndash;&gt;-->
            <!--&lt;!&ndash;</select>&ndash;&gt;-->
            <!--&lt;!&ndash;<input id="lang" value="Select" type="button"&ndash;&gt;-->
                   <!--&lt;!&ndash;style="padding-left:10px;padding-right:10px;color:black;   border-width: 3px 3px 3px 3px; border-color: floralwhite;"/>&ndash;&gt;-->
        <!--&lt;!&ndash;</div>&ndash;&gt;-->


        <!--&lt;!&ndash;<h5><strong>Upload your audio file below</strong></h5>&ndash;&gt;-->
        <!--&lt;!&ndash;<form method="POST" action="." enctype="multipart/form-data" class="form-inline" onSubmit="checkforblank()">&ndash;&gt;-->
            <!--&lt;!&ndash;<div class="form-group">&ndash;&gt;-->
                <!--&lt;!&ndash;<input name="file" id="file" type="file" class="form-control"&ndash;&gt;-->
                       <!--&lt;!&ndash;style="font-size:12px;background-color:#ececece5;padding-right:53px;padding-top:2px;width:auto;height:28px"/>&ndash;&gt;-->
                <!--&lt;!&ndash;<input type="submit" name="Submit" value="Submit"&ndash;&gt;-->
                       <!--&lt;!&ndash;style="margin-right:40px;padding-right:20px;padding-left:20px;margin-top:20px;color:black;border-width: 3px 3px 3px 3px; border-color: floralwhite;"/>&ndash;&gt;-->
            <!--&lt;!&ndash;</div>&ndash;&gt;-->
        <!--&lt;!&ndash;</form>&ndash;&gt;-->
        <!--&lt;!&ndash;<h5><strong>Or</strong></h5>&ndash;&gt;-->
        <!--&lt;!&ndash;<div id="audio" style="display:block;">&ndash;&gt;-->
            <!--&lt;!&ndash;<h5><strong>Record your audio here</strong></h5>&ndash;&gt;-->
            <!--&lt;!&ndash;<input type="button" id=startRecord value="Start Rec" onclick="startRecording()"&ndash;&gt;-->
                   <!--&lt;!&ndash;style="padding-left:30px;padding-right:30px;margin-right:43px;color:green;border-width: 3px 3px 3px 3px; border-color: floralwhite;"/>&ndash;&gt;-->
            <!--&lt;!&ndash;<input type="button" id=stopRecord value="Stop Rec" onclick="stopRecording()"&ndash;&gt;-->
                   <!--&lt;!&ndash;style="color:red;padding-left:30px;padding-right: 30px;margin-right:50px;margin-top:20px;border-width: 3px 3px 3px 3px; border-color: floralwhite;"/>&ndash;&gt;-->
        <!--&lt;!&ndash;</div>&ndash;&gt;-->
        <!--&lt;!&ndash;<p>&ndash;&gt;-->
            <!--&lt;!&ndash;<audio id=recordedAudio style="margin-right:57px;margin-top:20px;"></audio>&ndash;&gt;-->
        <!--&lt;!&ndash;</p>&ndash;&gt;-->
        <!--&lt;!&ndash; <p>-->
          <!--<a id=audioDownload></a>-->
        <!--</p> &ndash;&gt;-->
        <!--&lt;!&ndash;<br/>&ndash;&gt;-->
<!--&lt;!&ndash;&ndash;&gt;-->
    <!--</div>-->
    <!--&lt;!&ndash;changed from 176 line to 181&ndash;&gt;-->

<!--</div>-->


<div id="absolute1" style="display:None;">

    <form method="POST" action="feedback">


        <div class="container form-group" style="overflow-y:auto;">
            <label>correct the transcript</label>
            <textarea class="form-control" rows="2" placeholder="Please provide transcript for feedback:"
                      name="feedback"
                      style="overflow-y:auto;background-color:#ddeeee;font:1.2em  Calibri;border:2px inset #ddeeee;"
                      required>{{kalditranscript}}</textarea>
        </div>
        <div class="btn-group-vertical">
            <input type="submit" name="Submit" value="Submit" style="background-color:#ddeeee;">
        </div>
    </form>


</div>


<!--<div id="transcript" class="container"-->
     <!--style="background-color:rgb(218, 218, 218);width:50%;border:2px inset #ddeeee;padding-left:10px;display:{{vis}} ;">-->
    <!--<h4><strong>Original Text:</strong><i id="trans0" style="background-color:rgba(102, 102, 102, 0.3);">{{original_text}}</i>-->
    <!--</h4>-->
    <!--<h4><strong>Text: </strong><i id="trans">{{asr}}</i></h4>-->
    <!--<h4><strong>Speech Tags: </strong><i id="trans1">{{tag}}</i><h4>-->
            <!--<h4><strong>Processing Time: </strong><i id="trans2">{{processing_time}}</i><h4>-->

                <!--&lt;!&ndash; <ul id="trans" style="display:None;list-style-type:square;max-height:118px;overflow-y:auto;">-->
                <!--{%for transcript in transcripts%}-->
                <!--<li>{{transcript}}</li>-->
                <!--{%endfor%}-->
                <!--</ul>-->
                <!--<h4><strong>Kaldi Fischer</strong></h4>-->
                <!--<ul id="trans1" style="display:None;list-style-type:square;max-height:118px;overflow-y:auto;">-->
                <!--{%for transcript1 in transcripts1%}-->
                <!--<li>{{transcript1}}</li>-->
                <!--{%endfor%}-->
                <!--</ul> &ndash;&gt;-->
<!--</div>-->

</div>
<script>
    function checkforblank() {
        if (document.getElementById('file').value == "") {
            alert('please choose a valid file');
        }
        else {
            submit(blob);
        }
        return false;
        // document.getElementByID('file').style.borderColor="red";
    }

    // TODO: This needs work. Submit button currently does not do anything.
    // Also, page does not get reloaded and therefore the results are not shown.
    // The POST request has to be done without AJAX.
    rec = null

    function startRecording() {
        navigator.mediaDevices.getUserMedia({
            audio: true
        })
            .then(stream => {
                aCtx = new AudioContext();
                streamSource = aCtx.createMediaStreamSource(stream);
                rec = new Recorder(streamSource);
                startRecord.disabled = true;
                stopRecord.disabled = false;
                audio = [];
                recordedAudio.controls = false;
                rec.record();
            })
            .catch(e => console.log(e));


    }

    function stopRecording() {
        startRecord.disabled = false;
        stopRecord.disabled = true;

        rec.stop()
        rec.exportWAV((blob) => {
            // now we could send this blob with an FormData too
            $("#absolute1").css("display", "None")  // $("#audio").css("display:block")
            recordedAudio.src = URL.createObjectURL(blob);

            recordedAudio.controls = true;

            //audioDownload.href = recordedAudio.src;
            //audioDownload.download = 'muthootasr17283.wav';
            //audioDownload.innerHTML = 'Download';
            submit(blob);
        });
        return false;
    }

    function submit(blob) {

        var fd = new FormData();

        var val_lang = $("#country-select").val();
        //base64data = reader.result;
        //console.log(base64data);
        fd.append('file', blob, 'muthootasr17283.wav');

        $.ajax({
            type: 'POST',
            url: 'https://localhost:7000',       //172.16.250.83:7000 changes done
            data: fd,
            cache: false,
            processData: false,
            contentType: false,
            enctype: 'multipart/form-data',
            headers: {'lang': val_lang}
        }).done(function (data) {
            console.log('done', data);
            $("#trans0").text(data["original_text"]);   // changes
            $("#trans").text(data["asr"]);
            $("#trans1").text(data["tag"]);
            $("#trans2").text(data["processing_time"]);


            $("#transcript").css("display", data["vis"]);

            /* if(data.redirect){
                       window.location.href = data.redirect;
       return false;				}*/

            // var time= stop - start ;
            // console.log(time);
        });
        return false;
    }


</script>


</body>
</html>
